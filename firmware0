// ДАТЧИК СОЕДИНЯЕМ С ПОМПОЙ СОЕДЕНЯЕМ С ЧАСАМИ И РЕЛЕ НА ЛАМПУ 24.06

int aPin=A0;// контакт подключения аналогового выхода датчика
int phs=0; // переменная для сохранения значения датчика
int minvalue=220; // значение полного полива
int maxvalue=550; // значение критической сухости, было 600
//____________________________________________________________//NEXT COD POPM
int pump = 4;   // подключили насос 
//__________________________________________________________

#define PIN_RELAY 3 // Определяем пин, используемый для подключения реле
//_______________________________________________________________________________
#include <iarduino_RTC.h>
 iarduino_RTC time(RTC_DS1302, 8, 6, 7); 
 // подключаем RTC модуль на базе чипа DS1302, указывая выводы Arduino подключённые к выводам модуля RST, CLK, DAT

void setup()
{
delay(300);
Serial.begin(9600); // инициализация последовательного порта
  
pinMode(pump, OUTPUT); // настраиваем 8-й пин ножку на выход
time.begin(); // ЗАПУСТИЛИ ЧАСЫ
//___________________________________________________________
pinMode(PIN_RELAY, OUTPUT); // Объявляем пин реле как выход
digitalWrite(PIN_RELAY, HIGH); // Выключаем реле - посылаем высокий сигнал

}
void loop()
{
// Для проверки потом удалить :
  if(millis()%1000==0){ // если прошла 1 секунда
      Serial.println(time.gettime("d-m-Y, H:i:s, D")); // выводим время
      Serial.println(time.gettime("H")); 
      delay(1); // приостанавливаем на 1 мс, чтоб не выводить время несколько раз за 1мс
      }
//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^удалить после проверки ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^      
    time.period(1);
    if (time.gettime("H") > 7)       {
      digitalWrite(PIN_RELAY, LOW); // Включаем реле - посылаем низкий уровень сигнала
    }
    else {digitalWrite(PIN_RELAY, HIGH);}
  


  
phs=analogRead(aPin); // получение значения с аналогового вывода датчика
// вывод значения в монитор последовательного порта Arduino
//Serial.print("avalue=");Serial.println(avalue);
// пауза перед следующим получением значения 1000 мс
delay(1000);

if (phs > maxvalue) {
    analogWrite(pump, 130);// Устанавливаем скорость насоса на 4-й ножке:
    delay(2000); //включили мотор на 2 сек    
    analogWrite(pump, 0);// Устанавливаем скорость насоса на 4-й ножке:
    } 
}
